(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4aafcd7e"],{"022a":function(t,e,a){},"07ac":function(t,e,a){var n=a("23e7"),s=a("6f53").values;n({target:"Object",stat:!0},{values:function(t){return s(t)}})},"4b76":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page"},[a("ProposalForm",{attrs:{isEdit:!0,dateSource:t.proposalInfo,isCouncil:t.isCouncil,tokenInfo:t.tokenInfo,tokenAuth:t.tokenAuth,loadingApprove:t.loadingApprove,loadingAdd:t.loadingAdd},on:{approveToken:t.approveToken,addProposal:t.handleAdd}})],1)},s=[],o=a("1da1"),i=a("5530"),r=(a("96cf"),a("ac1f"),a("5319"),a("b0c0"),a("85b0")),c=a("fcfc"),l=a("1f5d"),p=a("f645"),u=a("2f62"),d={name:"",components:{ProposalForm:r["a"]},data:function(){return{point:.01,daoAt:"",isCouncil:!1,proposalInfo:{},tokenInfo:{name:"-",totalSupply:0,tokenAddress:""},tokenAuth:!1,loadingApprove:!1,loadingAdd:!1}},computed:Object(i["a"])({},Object(u["c"])(["proposalDetail"])),methods:{init:function(){this.getInfo()},getInfo:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("proposalDetail",t.proposalDetail),t.proposalDetail||t.$router.replace("/detail"),t.proposalInfo=t.proposalDetail,t.daoAt=t.proposalInfo.daoAt,t.proposalId=t.proposalInfo.index,t.tokenInfo.tokenAddress=t.proposalInfo.token,t.getIsCouncil(),t.getTokenInfo();case 8:case"end":return e.stop()}}),e)})))()},getIsCouncil:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c["a"].councliAt(t.daoAt);case 2:if(a=e.sent,a.success){e.next=5;break}return e.abrupt("return");case 5:a.result?t.isCouncil=!0:t.isCouncil=!1;case 6:case"end":return e.stop()}}),e)})))()},getTokenInfo:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.getSymbol(),e.next=3,t.getTotalSupply();case 3:t.getTokenAllance();case 4:case"end":return e.stop()}}),e)})))()},getSymbol:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,l["a"].getSymbol(t.tokenInfo.tokenAddress);case 2:if(a=e.sent,a.success){e.next=5;break}return e.abrupt("return");case 5:t.tokenInfo.name=a.result;case 6:case"end":return e.stop()}}),e)})))()},getTotalSupply:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,l["a"].totalSupply(t.tokenInfo.tokenAddress);case 2:if(a=e.sent,a.success){e.next=5;break}return e.abrupt("return");case 5:t.tokenInfo.totalSupply=a.result;case 6:case"end":return e.stop()}}),e)})))()},getTokenAllance:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,l["a"].allowance(t.tokenInfo.tokenAddress,p["a"].daoAddress);case 2:if(a=e.sent,a.success){e.next=5;break}return e.abrupt("return");case 5:n=a.result,t.tokenAuth=n>=t.tokenInfo.totalSupply*t.point;case 7:case"end":return e.stop()}}),e)})))()},approveToken:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loadingApprove=!0,e.next=3,l["a"].approve(t.tokenInfo.tokenAddress,p["a"].daoAddress);case 3:if(a=e.sent,t.loadingApprove=!1,a.success){e.next=7;break}return e.abrupt("return");case 7:t.tokenAuth=!0;case 8:case"end":return e.stop()}}),e)})))()},handleAdd:function(t,e,a,n){var s=this;return Object(o["a"])(regeneratorRuntime.mark((function o(){var i;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return s.loadingAdd=!0,o.next=3,c["a"].proposalEdit(s.daoAt,s.proposalId,t,e,a,n);case 3:if(i=o.sent,s.loadingAdd=!1,console.log(i),i.success){o.next=8;break}return o.abrupt("return");case 8:s.$toast("success"),s.$gbUtils.handleToPage("/detail");case 10:case"end":return o.stop()}}),o)})))()}},mounted:function(){this.init()},beforeDestroy:function(){}},m=d,h=(a("a551"),a("2877")),f=Object(h["a"])(m,n,s,!1,null,"0a66a475",null);e["default"]=f.exports},6746:function(t,e,a){"use strict";a("b7ef")},"6f53":function(t,e,a){var n=a("83ab"),s=a("e330"),o=a("df75"),i=a("fc6a"),r=a("d1e7").f,c=s(r),l=s([].push),p=function(t){return function(e){var a,s=i(e),r=o(s),p=r.length,u=0,d=[];while(p>u)a=r[u++],n&&!c(s,a)||l(d,t?[a,s[a]]:s[a]);return d}};t.exports={entries:p(!0),values:p(!1)}},"6fb1":function(t,e,a){},"85b0":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form"},[a("div",{staticClass:"info-box"},[a("div",{staticClass:"key-value"},[a("div",{staticClass:"key"},[t._v(" "+t._s(t.proposal.module+t.proposal.name)+" ")]),a("VanField",{staticClass:"input-box",attrs:{"input-align":"center",placeholder:t.common.pleaseInput,maxlength:"40"},model:{value:t.params1.name,callback:function(e){t.$set(t.params1,"name",e)},expression:"params1.name"}})],1),a("div",{staticClass:"key-value"},[a("div",{staticClass:"key"},[t._v(" "+t._s(t.proposal.module+t.proposal.content)+" ")]),a("VanField",{staticClass:"textarea-box",attrs:{type:"textarea",cols:"10",rows:"8",maxlength:"1000","show-word-limit":"",placeholder:t.common.pleaseInput},model:{value:t.params1.content,callback:function(e){t.$set(t.params1,"content",e)},expression:"params1.content"}})],1),a("div",{staticClass:"key-value"},[a("div",{staticClass:"key"},[t._v(" "+t._s(t.proposal.module+t.proposal.importantType)+" ")]),a("div",{staticClass:"btn-groups"},t._l(t.typeList,(function(e,n){return a("VanButton",{key:n,staticClass:"btn",class:{active:t.params2.type===t.typeList[n]},on:{click:function(e){return t.handleChange1(t.typeList[n])}}},[t._v(" "+t._s(t.proposal.list1[n])+" ")])})),1)]),a("div",{staticClass:"key-value"},[a("div",{staticClass:"key"},[t._v(" "+t._s(t.proposal.module+t.proposal.tag)+" ")]),a("div",{staticClass:"btn-groups"},t._l(t.typeList,(function(e,n){return a("VanButton",{key:n,staticClass:"btn",class:{active:t.params2.tag===t.typeList[n]},on:{click:function(e){return t.handleChange2(t.typeList[n])}}},[t._v(" "+t._s(t.proposal.list2[n])+" ")])})),1)]),a("div",{staticClass:"key-value"},[a("div",{staticClass:"key"},[t._v(" "+t._s(t.proposal.module+t.proposal.voteReward)+" "),a("span",{staticClass:"fu-title"},[t._v(t._s(t.proposal.voteTip)+"("+t._s(t.tokenInfo.name)+")")])]),a("div",{staticClass:"btn-groups not-justify"},[a("VanButton",{staticClass:"btn",class:{active:t.isReward},attrs:{disabled:t.isEdit},on:{click:function(e){return t.handleChange3(!0)}}},[t._v(" "+t._s(t.common.open)+" ")]),a("VanButton",{staticClass:"btn",class:{active:!t.isReward},attrs:{disabled:t.isEdit},on:{click:function(e){return t.handleChange3(!1)}}},[t._v(" "+t._s(t.common.close)+" ")])],1)]),t.isReward?a("div",{staticClass:"key-value"},[a("div",{staticClass:"key"},[t._v(" "+t._s(t.proposal.rewardTotal)+" ")]),a("VanField",{staticClass:"input-box",attrs:{"input-align":"center",placeholder:t.common.pleaseInput,disabled:t.isEdit,maxlength:"40"},model:{value:t.params2.reward,callback:function(e){t.$set(t.params2,"reward",e)},expression:"params2.reward"}}),a("div",{staticClass:"margin-height fu-title"},[t._v(t._s(t.proposal.rewardTip))])],1):t._e(),a("div",{staticClass:"key-value"},[a("div",{staticClass:"key"},[t._v(" "+t._s(t.proposal.voteTime)+" ")]),a("div",{staticClass:"time-wrapper input-box _flex"},[a("svg",{staticClass:"time-icon",attrs:{"aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),t.closePop.apply(null,arguments)}}},[a("use",{attrs:{"xlink:href":"#shijian"}})]),a("VanButton",{staticClass:"time-box",class:{activeColor:t.startDate},attrs:{disabled:t.isEdit},on:{click:function(){t.startTimeShow=!0}}},[t._v(" "+t._s(t.startDate?t.startDate:t.$t("common.startTime"))+" ")]),a("div",{staticClass:"line"}),a("VanButton",{staticClass:"time-box",class:{activeColor:t.endDate},attrs:{disabled:!t.startDate||t.isEdit},on:{click:function(){t.endTimeShow=!0}}},[t._v(" "+t._s(t.endDate?t.endDate:t.$t("common.endTime"))+" ")])],1),t._e()]),a("div",{staticClass:"key-value"},[a("div",{staticClass:"key"},[t._v(" "+t._s(t.proposal.votingSystem)+" ")]),a("div",{staticClass:"btn-groups not-justify"},[a("VanButton",{staticClass:"btn",class:{active:!t.mutilOption},on:{click:function(e){return t.handleChange4(!1)}}},[t._v(" "+t._s(t.common.single)+" ")]),a("VanButton",{staticClass:"btn",class:{active:t.mutilOption},on:{click:function(e){return t.handleChange4(!0)}}},[t._v(" "+t._s(t.common.multi)+" ")])],1)]),t._l(t.options,(function(e,n){return a("div",{key:n,staticClass:"key-value"},[a("div",{staticClass:"key"},[a("span",[t._v(t._s(t.proposal.option)+t._s(n+1))]),n>=2?a("span",{staticClass:"del-btn",on:{click:function(e){return t.delPlan(n)}}},[t._v(t._s(t.common.delete))]):t._e()]),a("VanField",{staticClass:"input-box",attrs:{"input-align":"center",maxlength:"100",placeholder:t.common.pleaseInput},model:{value:t.options[n],callback:function(e){t.$set(t.options,n,e)},expression:"options[index]"}})],1)})),a("VanButton",{staticClass:"add-btn",attrs:{disabled:t.options.length>=10},on:{click:t.handleAddPlan}},[t._v(t._s(t.proposal.addOptions)),a("span",{staticClass:"size-12"},[t._v(t._s(t.proposal.maxOptions))])])],2),t.isCouncil?t._e():a("div",{staticClass:"tips"},[t._v(" "+t._s(t.$t("proposal.needStake"))+" （"+t._s(t.$gbUtils.formatNumber(t.tokenInfo.totalSupply*t.point))+" "+t._s(t.tokenInfo.name)+"）"+t._s(t.$t("proposal.canSubmit"))+" ")]),t.isReward?a("div",{staticClass:"tips"},[t._v(" "+t._s(t.$t("proposal.needPay"))+" "+t._s(t.params2.reward)+" "+t._s(t.tokenInfo.name)+t._s(t.$t("common.usedFor")+t.$t("proposal.voteReward"))+" ")]):t._e(),a("div",{staticClass:"bottom-class"},[a("div",{staticClass:"_flex"},[a("VanButton",{staticClass:"create-btn",attrs:{loading:t.loadingApprove,disabled:t.tokenAuth},on:{click:t.approveToken}},[t._v(" "+t._s(t.common.Apporve)+" ")]),a("VanButton",{staticClass:"create-btn",attrs:{loading:t.loadingAdd,disabled:!t.tokenAuth||!t.params1.name||!t.params1.content||t.isReward&&t.params2.reward<=0},on:{click:t.handleAdd}},[t._v(" "+t._s(t.isEdit?t.$t("common.confrim"):t.$t("proposal.satkeAndSubmit"))+" ")])],1),a("div",{staticClass:"tips"},[t._v(t._s(t.$t("proposal.endNotice")))])]),a("van-popup",{staticStyle:{"min-width":"320px",width:"95%"},attrs:{round:"",position:"center"},model:{value:t.startTimeShow,callback:function(e){t.startTimeShow=e},expression:"startTimeShow"}},[a("van-datetime-picker",{attrs:{type:"datetime","confirm-button-text":t.$t("common.confirm"),"cancel-button-text":t.$t("common.cancel"),title:t.$t("proposal.startTime"),"min-date":new Date,"max-date":t.startMaxDate},on:{confirm:t.handleStartTime,cancel:function(){t.startTimeShow=!1}}})],1),a("van-popup",{staticStyle:{"min-width":"370px"},attrs:{round:"",position:"center"},model:{value:t.endTimeShow,callback:function(e){t.endTimeShow=e},expression:"endTimeShow"}},[a("van-datetime-picker",{attrs:{"min-date":t.endMinDate,"max-date":t.endMaxDate,type:"datetime",title:t.$t("proposal.endTime"),"confirm-button-text":t.$t("common.confirm"),"cancel-button-text":t.$t("common.cancel")},on:{confirm:t.handleEndTime,cancel:function(){t.endTimeShow=!1}}})],1)],1)},s=[],o=(a("b0c0"),a("a434"),a("4de4"),a("d3b7"),a("07ac"),{name:"",props:["isEdit","tokenInfo","isCouncil","tokenAuth","loadingApprove","loadingAdd","dateSource"],data:function(){return{point:.01,typeList:[10,20,30],params1:{name:"",content:""},params2:{type:10,tag:10,reward:0,startTime:"",endTime:""},startTimeShow:!1,endTimeShow:!1,startDate:null,endDate:null,startMaxDate:null,endMinDate:null,endMaxDate:null,options:["",""],isReward:!1,mutilOption:!1}},computed:{proposal:function(){return this.$t("proposal")},common:function(){return this.$t("common")}},methods:{init:function(){this.startMaxDate=this.$moment(new Date).add("days",7)._d,this.formatData()},formatData:function(){if(this.dateSource&&this.dateSource.token){var t=this.dateSource;this.params1.name=t.name_desc[0],this.params1.content=t.name_desc[1],this.params2={type:parseInt(t.uintParams[0]),tag:parseInt(t.uintParams[1]),reward:t.uintParams[2],startTime:t.uintParams[3],endTime:t.uintParams[4]},this.mutilOption=t.mutilOption,this.options=t.options||[],this.startDate=this.$moment(1e3*t.uintParams[3]).format("YYYY-MM-DD HH:mm"),this.endDate=this.$moment(1e3*t.uintParams[4]).format("YYYY-MM-DD HH:mm")}},handleAddPlan:function(){this.options.push("")},delPlan:function(t){this.options.splice(t,1)},handleChange1:function(t){this.params2.type=t},handleChange2:function(t){this.params2.tag=t},handleChange3:function(t){this.isReward=t},handleChange4:function(t){this.mutilOption=t},approveToken:function(){this.$emit("approveToken")},handleAdd:function(){var t=this.options.filter((function(t){return""!==t}));if(!this.params2.startTime)return this.$toast(this.common.pleaseInput+this.proposal.startTime);if(!this.params2.endTime)return this.$toast(this.common.pleaseInput+this.proposal.endTime);if(this.isReward&&this.params2.reward<=0)return this.$toast(this.common.pleaseInput+this.proposal.rewardTotal);if(t.length<=1)return this.$toast(this.common.pleaseInput+this.proposal.option);this.isReward||(this.params2.reward=0);var e=Object.values(this.params1),a=Object.values(this.params2);a[2]=this.$web3.toWei(a[2]),this.$emit("addProposal",e,a,this.mutilOption,t)},handleStartTime:function(t){this.startDate=this.$moment(t).format("YYYY-MM-DD HH:mm"),this.params2.startTime=this.dateToMs(t),this.endMinDate=this.$moment(t).add("days",0)._d,console.log("this.endMinDate",this.endMinDate),this.endMaxDate=this.$moment(t).add("days",30)._d,this.params2.endTime&&(this.endDate=this.$moment(t).format("YYYY-MM-DD HH:mm"),this.params2.endTime=this.dateToMs(t)),this.startTimeShow=!1},handleEndTime:function(t){this.params2.endTime=this.dateToMs(t),this.endDate=this.$moment(t).format("YYYY-MM-DD HH:mm"),this.endTimeShow=!1},dateToMs:function(t){var e=new Date(t).getTime()/1e3;return e}},watch:{startDate:function(t){},dateSource:{handler:function(t){this.formatData()},deep:!0}},mounted:function(){this.init()}}),i=o,r=(a("6746"),a("e5cf"),a("2877")),c=Object(r["a"])(i,n,s,!1,null,"aeee84a6",null);e["a"]=c.exports},a434:function(t,e,a){"use strict";var n=a("23e7"),s=a("da84"),o=a("23cb"),i=a("5926"),r=a("07fa"),c=a("7b0b"),l=a("65f0"),p=a("8418"),u=a("1dde"),d=u("splice"),m=s.TypeError,h=Math.max,f=Math.min,v=9007199254740991,k="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!d},{splice:function(t,e){var a,n,s,u,d,b,g=c(this),w=r(g),_=o(t,w),C=arguments.length;if(0===C?a=n=0:1===C?(a=0,n=w-_):(a=C-2,n=f(h(i(e),0),w-_)),w+a-n>v)throw m(k);for(s=l(g,n),u=0;u<n;u++)d=_+u,d in g&&p(s,u,g[d]);if(s.length=n,a<n){for(u=_;u<w-n;u++)d=u+n,b=u+a,d in g?g[b]=g[d]:delete g[b];for(u=w;u>w-n+a;u--)delete g[u-1]}else if(a>n)for(u=w-n;u>_;u--)d=u+n-1,b=u+a-1,d in g?g[b]=g[d]:delete g[b];for(u=0;u<a;u++)g[u+_]=arguments[u+2];return g.length=w-n+a,s}})},a551:function(t,e,a){"use strict";a("022a")},b7ef:function(t,e,a){},e5cf:function(t,e,a){"use strict";a("6fb1")}}]);
//# sourceMappingURL=chunk-4aafcd7e.65959867.js.map